@page "/mainpage"
@using ClientPost.Pages
<PageTitle>Trang chủ</PageTitle>
<MenuMainPage Label="Trang chủ" IsLoading="@(_lstMajor == null)" DisableSearch="_isDisableControls">
    <BodyContent>
        <MudPaper Elevation="0">
            <MudPaper Class="my-4" Elevation="0">
                <MudGrid>
                    <MudItem xs="7" sm="8"  Class="d-flex align-left flex-start">
                        <MudText Typo="Typo.h6" Class="my-4" Style="font-weight: bold;">Hệ thống</MudText>
                    </MudItem>
                    <MudItem xs="5" sm="4"  Class="d-flex justify-end align-center">
                        <MudText><MudNavLink Href="@($"/postbysystem")">>> Tất cả</MudNavLink></MudText>
                    </MudItem>
                </MudGrid>
            </MudPaper>
            
            <PostList isClickNext="@isClickNext" MajorId="@null"></PostList>
            @foreach (var item in _lstMajor)
            {
                <MudPaper Class="my-4" Elevation="0">
                    <MudGrid>
                        <MudItem xs="7" sm="8" >
                            <MudTooltip Text="@item.Name" Arrow="true" Placement="Placement.Top"><MudText Typo="Typo.h6" Class="my-4 truncated-text" Style="font-weight: bold;">Chuyên ngành @item.Name</MudText></MudTooltip>
                            
                        </MudItem>
                        <MudItem xs="5" sm="4"  Class="d-flex justify-end align-center">
                            <MudText><MudNavLink Href="@($"/postbymajor/{item.Id}")">>> Tất cả</MudNavLink></MudText>
                        </MudItem>
                    </MudGrid>
                </MudPaper>
                <PostList isClickNext="@isClickNext" MajorId="@item.Id.ToString()"></PostList>
            }
            <CustomePagination Class="my-1" HasNext="@_majorDTOS.HasNext" OnPageChange="@(async e=> await  OnPaginationButtonClick(e))" CurrentPageNumber="@_majorDTOS.PageNumber"></CustomePagination>
        </MudPaper>
    </BodyContent>
</MenuMainPage>
@code {
    #region Khai báo
    [Inject]
    public IClientPostService ClientPostService { get; set; }

    private PaginationRequest _paginationRequest = new();
    private ClientPostMajorRequestWithPagination _request { get; set; } = new();
    private PaginationResponse<MajorBaseDTO> _majorDTOS;
    private List<MajorBaseDTO> _lstMajor;
    private bool _isLoadingAll = true;
    private bool _isLoadingList = true;
    private bool _isDisableControls = false;
    private Guid _idMajorDetail = Guid.Empty;
    private bool isClickNext = false;

    #endregion
    protected async override Task OnInitializedAsync()
    {
        await LoadData();
    }
    private async Task LoadData()
    {
        //lấy ra tên major và id của nó
        _majorDTOS = await ClientPostService.GetMajorList(_request);
        _lstMajor = _majorDTOS.Data.ToList();
        isClickNext = false;
    }
    private async Task OnPaginationButtonClick(int pageNumber)
    {
        if (_isDisableControls) return;
        _isLoadingList = true;
        _request.PageNumber = pageNumber;
        isClickNext = true;
        await LoadData();
        
    }
    
}
